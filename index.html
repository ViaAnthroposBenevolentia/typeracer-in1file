<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Majestic Typeracer</title>
    <style>
        /* CSS Variables for Themes */
        :root {
            --primary-color: #4A90E2;
            --secondary-color: #50E3C2;
            --background-color: #f0f4f8;
            --text-color: #333;
            --error-color: #E94E77;
            --success-color: #28a745;
            --font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        [data-theme="dark"] {
            --primary-color: #1E1E1E;
            --secondary-color: #333;
            --background-color: #121212;
            --text-color: #f0f4f8;
            --error-color: #ff6b6b;
            --success-color: #4caf50;
        }

        /* Global Styles */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: var(--font-family);
            background-color: var(--background-color);
            color: var(--text-color);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        a {
            color: var(--primary-color);
            text-decoration: none;
        }

        a:hover {
            text-decoration: underline;
        }

        /* Header */
        header {
            background: var(--primary-color);
            color: #fff;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        header .logo {
            font-size: 1.5rem;
            font-weight: bold;
        }

        header nav a {
            margin-left: 20px;
            font-size: 1rem;
        }

        /* Main Content */
        main {
            flex: 1;
            padding: 40px 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            background: linear-gradient(135deg, #ece9e6, #ffffff);
            animation: backgroundAnimation 15s infinite alternate;
        }

        @keyframes backgroundAnimation {
            0% { background: linear-gradient(135deg, #ece9e6, #ffffff); }
            100% { background: linear-gradient(135deg, #f0f4f8, #e0eafc); }
        }

        .landing {
            text-align: center;
            margin-top: 50px;
        }

        .landing h1 {
            font-size: 3rem;
            margin-bottom: 20px;
            color: var(--primary-color);
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .landing button {
            padding: 15px 30px;
            font-size: 1.2rem;
            background-color: var(--secondary-color);
            border: none;
            border-radius: 5px;
            color: #fff;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .landing button:hover {
            background-color: darken(var(--secondary-color), 10%);
        }

        /* Typing Test Section */
        .typing-test {
            display: none;
            width: 100%;
            max-width: 800px;
            background: rgba(255, 255, 255, 0.9);
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            animation: fadeIn 1s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .passage {
            font-size: 1.2rem;
            line-height: 1.6;
            margin-bottom: 20px;
            user-select: none;
        }

        .passage .current {
            background-color: rgba(74, 144, 226, 0.3);
            border-radius: 3px;
        }

        .passage .correct {
            color: var(--success-color);
        }

        .passage .incorrect {
            color: var(--error-color);
        }

        .input-area {
            width: 100%;
            padding: 15px;
            font-size: 1.2rem;
            border: 2px solid var(--primary-color);
            border-radius: 5px;
            outline: none;
            transition: border-color 0.3s ease;
        }

        .input-area:focus {
            border-color: var(--secondary-color);
        }

        /* Statistics Panel */
        .stats {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
            font-size: 1rem;
        }

        .stats div {
            text-align: center;
        }

        .progress-bar-container {
            width: 100%;
            background-color: #ddd;
            border-radius: 5px;
            overflow: hidden;
            margin-top: 20px;
        }

        .progress-bar {
            height: 10px;
            width: 0%;
            background-color: var(--secondary-color);
            transition: width 0.3s ease;
        }

        /* Footer */
        footer {
            background: var(--primary-color);
            color: #fff;
            text-align: center;
            padding: 15px;
        }

        footer a {
            color: #fff;
            margin: 0 10px;
        }

        /* Settings Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.5);
            animation: fadeIn 0.5s ease-in-out;
        }

        .modal-content {
            background-color: var(--background-color);
            margin: 10% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 90%;
            max-width: 500px;
            border-radius: 10px;
            position: relative;
        }

        .close {
            color: #aaa;
            position: absolute;
            top: 10px;
            right: 20px;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover,
        .close:focus {
            color: #000;
        }

        .settings-group {
            margin-bottom: 20px;
        }

        .settings-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .settings-group input[type="range"],
        .settings-group select {
            width: 100%;
            padding: 5px;
            font-size: 1rem;
        }

        .theme-toggle {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        /* Responsive Design */
        @media (max-width: 600px) {
            .landing h1 {
                font-size: 2rem;
            }

            .landing button {
                width: 100%;
                font-size: 1rem;
            }

            .stats {
                flex-direction: column;
                gap: 10px;
            }
        }
    </style>
</head>
<body data-theme="light">
    <!-- Header -->
    <header>
        <div class="logo">Majestic Typeracer</div>
        <nav>
            <a href="#" id="home-link">Home</a>
            <a href="#" id="settings-link">Settings</a>
            <a href="#" id="about-link">About</a>
        </nav>
    </header>

    <!-- Main Content -->
    <main>
        <!-- Landing Section -->
        <section class="landing" id="landing-section">
            <h1>Welcome to Majestic Typeracer</h1>
            <button id="start-button">Start Typing Test</button>
        </section>

        <!-- Typing Test Section -->
        <section class="typing-test" id="typing-test-section">
            <div class="passage" id="passage">
                <!-- Passage text will be injected here -->
            </div>
            <input type="text" id="input-area" class="input-area" placeholder="Start typing here..." autofocus>
            <div class="stats">
                <div>
                    <strong>WPM</strong>
                    <div id="wpm">0</div>
                </div>
                <div>
                    <strong>Accuracy</strong>
                    <div id="accuracy">100%</div>
                </div>
                <div>
                    <strong>Errors</strong>
                    <div id="errors">0</div>
                </div>
                <div>
                    <strong>Time</strong>
                    <div id="time">0s</div>
                </div>
            </div>
            <div class="progress-bar-container">
                <div class="progress-bar" id="progress-bar"></div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer>
        <p>&copy; 2024 Majestic Typeracer. All rights reserved.</p>
        <div>
            <a href="#">Facebook</a> |
            <a href="#">Twitter</a> |
            <a href="#">Contact</a>
        </div>
    </footer>

    <!-- Settings Modal -->
    <div id="settings-modal" class="modal">
        <div class="modal-content">
            <span class="close" id="close-settings">&times;</span>
            <h2>Settings</h2>
            <div class="settings-group">
                <label for="theme-select">Theme</label>
                <select id="theme-select">
                    <option value="light">Light</option>
                    <option value="dark">Dark</option>
                </select>
            </div>
            <div class="settings-group">
                <label for="font-size">Font Size</label>
                <input type="range" id="font-size" min="14" max="24" value="16">
            </div>
            <div class="settings-group">
                <label for="font-family">Font Family</label>
                <select id="font-family">
                    <option value="'Segoe UI', Tahoma, Geneva, Verdana, sans-serif">Default</option>
                    <option value="'Courier New', Courier, monospace">Courier New</option>
                    <option value="'Georgia', serif">Georgia</option>
                    <option value="'Roboto', sans-serif">Roboto</option>
                </select>
            </div>
            <div class="settings-group">
                <label for="background-music">Background Music</label>
                <select id="background-music">
                    <option value="none">None</option>
                    <option value="music1">Calm Waves</option>
                    <option value="music2">Forest Ambience</option>
                </select>
            </div>
        </div>
    </div>

    <!-- About Modal -->
    <div id="about-modal" class="modal">
        <div class="modal-content">
            <span class="close" id="close-about">&times;</span>
            <h2>About Majestic Typeracer</h2>
            <p>Majestic Typeracer is a beautifully crafted typing practice tool designed to help you improve your typing speed and accuracy. Enjoy a majestic visual experience while honing your skills.</p>
        </div>
    </div>

    <!-- Audio Elements for Background Music -->
    <audio id="music1" loop>
        <source src="https://example.com/calm-waves.mp3" type="audio/mpeg">
    </audio>
    <audio id="music2" loop>
        <source src="https://example.com/forest-ambience.mp3" type="audio/mpeg">
    </audio>

    <script>
        // JavaScript Code

        // Data: Passages
        const passages = [
            {
                text: "The quick brown fox jumps over the lazy dog. This pangram is often used to test typing speed and accuracy.",
                difficulty: "Easy"
            },
            {
                text: "In the midst of chaos, there is also opportunity. Embrace the challenges and turn them into stepping stones for success.",
                difficulty: "Medium"
            },
            {
                text: "To be, or not to be, that is the question. Whether 'tis nobler in the mind to suffer the slings and arrows of outrageous fortune.",
                difficulty: "Hard"
            },
            // Add more passages as needed
        ];

        // DOM Elements
        const startButton = document.getElementById('start-button');
        const landingSection = document.getElementById('landing-section');
        const typingTestSection = document.getElementById('typing-test-section');
        const passageElement = document.getElementById('passage');
        const inputArea = document.getElementById('input-area');
        const wpmElement = document.getElementById('wpm');
        const accuracyElement = document.getElementById('accuracy');
        const errorsElement = document.getElementById('errors');
        const timeElement = document.getElementById('time');
        const progressBar = document.getElementById('progress-bar');
        const homeLink = document.getElementById('home-link');
        const settingsLink = document.getElementById('settings-link');
        const aboutLink = document.getElementById('about-link');
        const settingsModal = document.getElementById('settings-modal');
        const closeSettings = document.getElementById('close-settings');
        const aboutModal = document.getElementById('about-modal');
        const closeAbout = document.getElementById('close-about');
        const themeSelect = document.getElementById('theme-select');
        const fontSizeSlider = document.getElementById('font-size');
        const fontFamilySelect = document.getElementById('font-family');
        const backgroundMusicSelect = document.getElementById('background-music');

        // Audio Elements
        const music1 = document.getElementById('music1');
        const music2 = document.getElementById('music2');

        // State Variables
        let currentPassage = '';
        let currentIndex = 0;
        let timer = null;
        let startTime = null;
        let errorCount = 0;
        let totalKeystrokes = 0;
        let correctKeystrokes = 0;

        // Initialize
        function init() {
            // Event Listeners
            startButton.addEventListener('click', startTest);
            inputArea.addEventListener('input', handleInput);
            homeLink.addEventListener('click', showHome);
            settingsLink.addEventListener('click', openSettings);
            aboutLink.addEventListener('click', openAbout);
            closeSettings.addEventListener('click', closeSettingsModal);
            closeAbout.addEventListener('click', closeAboutModal);
            themeSelect.addEventListener('change', changeTheme);
            fontSizeSlider.addEventListener('input', changeFontSize);
            fontFamilySelect.addEventListener('change', changeFontFamily);
            backgroundMusicSelect.addEventListener('change', changeBackgroundMusic);

            // Load Preferences
            loadPreferences();
        }

        // Start Typing Test
        function startTest() {
            landingSection.style.display = 'none';
            typingTestSection.style.display = 'block';
            resetTest();
            loadPassage();
            inputArea.focus();
        }

        // Load a Random Passage
        function loadPassage() {
            const randomIndex = Math.floor(Math.random() * passages.length);
            currentPassage = passages[randomIndex].text;
            displayPassage(currentPassage);
        }

        // Display Passage with Span Elements
        function displayPassage(text) {
            passageElement.innerHTML = '';
            text.split('').forEach((char, index) => {
                const span = document.createElement('span');
                span.innerText = char;
                if (index === 0) {
                    span.classList.add('current');
                }
                passageElement.appendChild(span);
            });
        }

        // Handle User Input
        function handleInput(e) {
            const input = inputArea.value;
            if (!startTime) {
                startTimer();
            }

            const chars = passageElement.querySelectorAll('span');
            let correct = true;

            // Iterate through each character in input
            for (let i = 0; i < chars.length; i++) {
                const char = input[i];
                if (char == null) {
                    chars[i].classList.remove('correct', 'incorrect');
                    correct = false;
                } else if (char === chars[i].innerText) {
                    chars[i].classList.add('correct');
                    chars[i].classList.remove('incorrect');
                } else {
                    chars[i].classList.add('incorrect');
                    chars[i].classList.remove('correct');
                    correct = false;
                }
            }

            // Update Metrics
            updateMetrics(input);

            // Update Progress Bar
            const progress = Math.min((input.length / currentPassage.length) * 100, 100);
            progressBar.style.width = progress + '%';

            // Check Completion
            if (input.length === currentPassage.length) {
                endTest();
            }
        }

        // Update Metrics
        function updateMetrics(input) {
            totalKeystrokes = input.length;
            correctKeystrokes = 0;
            errorCount = 0;

            const chars = passageElement.querySelectorAll('span');
            chars.forEach((char, index) => {
                if (input[index] === char.innerText) {
                    correctKeystrokes++;
                } else if (input[index] && input[index] !== char.innerText) {
                    errorCount++;
                }
            });

            const timeElapsed = (Date.now() - startTime) / 1000 / 60; // in minutes
            const wpm = Math.round((correctKeystrokes / 5) / timeElapsed) || 0;
            const accuracy = totalKeystrokes ? Math.round((correctKeystrokes / totalKeystrokes) * 100) : 100;

            wpmElement.innerText = wpm;
            accuracyElement.innerText = accuracy + '%';
            errorsElement.innerText = errorCount;
            timeElement.innerText = Math.floor((Date.now() - startTime) / 1000) + 's';
        }

        // Timer Functions
        function startTimer() {
            startTime = Date.now();
            timer = setInterval(() => {
                const timeElapsed = Math.floor((Date.now() - startTime) / 1000);
                timeElement.innerText = timeElapsed + 's';
            }, 1000);
        }

        function endTest() {
            clearInterval(timer);
            inputArea.disabled = true;
            setTimeout(() => {
                alert(`Test Completed!\nWPM: ${wpmElement.innerText}\nAccuracy: ${accuracyElement.innerText}\nErrors: ${errorsElement.innerText}`);
                showHome();
            }, 100);
        }

        // Reset Test
        function resetTest() {
            inputArea.value = '';
            inputArea.disabled = false;
            currentIndex = 0;
            errorCount = 0;
            totalKeystrokes = 0;
            correctKeystrokes = 0;
            wpmElement.innerText = '0';
            accuracyElement.innerText = '100%';
            errorsElement.innerText = '0';
            timeElement.innerText = '0s';
            progressBar.style.width = '0%';
            clearInterval(timer);
            startTime = null;
        }

        // Show Home/Landing Section
        function showHome() {
            typingTestSection.style.display = 'none';
            landingSection.style.display = 'block';
        }

        // Settings Modal Functions
        function openSettings() {
            settingsModal.style.display = 'block';
        }

        function closeSettingsModal() {
            settingsModal.style.display = 'none';
        }

        // About Modal Functions
        function openAbout() {
            aboutModal.style.display = 'block';
        }

        function closeAboutModal() {
            aboutModal.style.display = 'none';
        }

        // Change Theme
        function changeTheme(e) {
            const theme = e.target.value;
            document.body.setAttribute('data-theme', theme);
            savePreferences();
        }

        // Change Font Size
        function changeFontSize(e) {
            const size = e.target.value + 'px';
            passageElement.style.fontSize = size;
            inputArea.style.fontSize = size;
            savePreferences();
        }

        // Change Font Family
        function changeFontFamily(e) {
            const font = e.target.value;
            document.body.style.fontFamily = font;
            savePreferences();
        }

        // Change Background Music
        function changeBackgroundMusic(e) {
            const music = e.target.value;
            music1.pause();
            music2.pause();
            if (music === 'music1') {
                music1.play();
            } else if (music === 'music2') {
                music2.play();
            }
            savePreferences();
        }

        // Save Preferences to Local Storage
        function savePreferences() {
            const preferences = {
                theme: themeSelect.value,
                fontSize: fontSizeSlider.value,
                fontFamily: fontFamilySelect.value,
                backgroundMusic: backgroundMusicSelect.value
            };
            localStorage.setItem('typeracerPreferences', JSON.stringify(preferences));
        }

        // Load Preferences from Local Storage
        function loadPreferences() {
            const preferences = JSON.parse(localStorage.getItem('typeracerPreferences'));
            if (preferences) {
                themeSelect.value = preferences.theme;
                document.body.setAttribute('data-theme', preferences.theme);
                fontSizeSlider.value = preferences.fontSize;
                passageElement.style.fontSize = preferences.fontSize + 'px';
                inputArea.style.fontSize = preferences.fontSize + 'px';
                fontFamilySelect.value = preferences.fontFamily;
                document.body.style.fontFamily = preferences.fontFamily;
                backgroundMusicSelect.value = preferences.backgroundMusic;
                if (preferences.backgroundMusic === 'music1') {
                    music1.play();
                } else if (preferences.backgroundMusic === 'music2') {
                    music2.play();
                }
            }
        }

        // Close Modals on Outside Click
        window.onclick = function(event) {
            if (event.target == settingsModal) {
                settingsModal.style.display = "none";
            }
            if (event.target == aboutModal) {
                aboutModal.style.display = "none";
            }
        }

        // Initialize on Page Load
        window.onload = init;
    </script>
</body>
</html>
